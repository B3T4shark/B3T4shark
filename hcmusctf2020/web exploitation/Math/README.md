## ⚡ [Math](https://ctf.hcmus.edu.vn/challenges#Quelcome)

[![df](https://img.shields.io/badge/B3T4-shark-brightgreen.svg)](https://img.shields.io/badge/B3T4-shark-brightgreen.svg)
[![df](https://img.shields.io/badge/member-BHD233-brightgreen.svg)](https://img.shields.io/badge/member-BHD233-brightgreen.svg)
[![df](https://img.shields.io/badge/116-pts-brightgreen.svg)](https://img.shields.io/badge/116-pts-brightgreen.svg)


Tác giả: `tunt` `Glutamo Team`



Tags: `web exploitation` 


### Challenge Description

Đề bài cho một đường link trang web với với một đống phép toán mà chỉ có một phép toán đúng và yêu cầu nhập kết quả.

http://35.187.250.39:8080/

### Summary
Sau một lúc tìm hiểu thì ta nhận ra quy luật là chọn phép toán có độ dài lớn nhất và nhập kêt quả phép toán đó (giống nguyên lý chọn câu dài nhất của trắc nghiệm).

Sau khi biết quy luật và thử tay đúng tới 50 lần nhưng vẫn không ra flag, vậy là phải bắt tay vào code chứ không thể làm bằng tay thêm nữa.

Sau khi phân tích gói tin, ta nhận ra cần gửi gói get với Cookie và 1 biến result. Thử bằng postman với cookie lấy được từ gói đó luôn và ta thấy có hiệu quả. 

Việc cần làm bây giờ đơn giản là chọn phép toán, tính và gửi kết quả đi.

Sau một hồi tìm kiếm thì đã phát hiện ra API để thực hiện tính toán: https://api.mathjs.org

Vậy ta bắt tay vào code (sử dụng java):

```java
class Test {
    public static void main(String[ ] args) {
        String re = "0";
        
        while (true) {
            OkHttpClient client = new OkHttpClient().newBuilder().build();
            MediaType mediaType = MediaType.parse("text/plain");
            RequestBody body = new MultipartBody.Builder().setType(MultipartBody.FORM)
                                    .addFormDataPart("result", re)
                                    .build();
            Request request = new Request.Builder()
                              .url("http://35.187.250.39:8080/index.php?result=6231")
                              .method("POST", body)
                              .addHeader("Cookie", "PHPSESSID=pjbom1pvbijp19rc24qfvdad54")
                              .build();
            Response response = client.newCall(request).execute();
            
            String str = response.body().string();
            
            if (str.indexOf("HCMUS-CTF") >= 0) {
                System.out.println(str);
                break;
            }
            
            String[] strs = str.split("<br>");
            
            List<String> calcs = new ArrayList<String>(); 
            
            for(String g : strs){
                String[] h = g.split(" ");
                
                String calc = h[0];
                for (String f : h) {
                    if (f.length() > calc.length()) {
                        calc = f;
                    }
                }
                
                calcs.add(calc);
            }
            
            String trueCalc = calcs[0];
            for (String calc : calcs) {
                if (calc[i].length() > trueCalc.length()){
                    trueCalc = calc[i];
                }
            }
            
            client = new OkHttpClient().newBuilder()
              .build();
            request = new Request.Builder()
              .url("https://api.mathjs.org/v4/?expr=" + trueCalc + "&precision=0")
              .method("GET", null)
              .addHeader("Content-Type", "application/json")
              .build();
            response = client.newCall(request).execute();
            
            String result = response.body().string();
            
            re = result;
        }
    }
}
```

📫 Flag: **`HCMUS-CTF{1+2_3_32_1_H0w_d0_u_4Ut0?}`**

---
*[Back to table of contents](../README.md)*
